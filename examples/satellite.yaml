# Satellite configuration example
# Runs local checks and exposes /health endpoint

satellite:
  port: 9855
  bind: "0.0.0.0"

  checks:
    # Simple HTTP health check
    api_health:
      actions:
        - name: fetch
          action: "http_get"
          config:
            url: "http://localhost:8080/health"

        - action: "compare_number"
          config:
            value: "{{ fetch.status_code }}"
            threshold: 200
            operator: "=="

    # HTTP check with basic auth using environment variables
    api_auth:
      actions:
        - name: fetch
          action: "http_get"
          config:
            url: "http://localhost:8080/api/protected"
            auth:
              type: "basic"
              username_env: "API_USERNAME"  # Reads from $API_USERNAME
              password_env: "API_PASSWORD"  # Reads from $API_PASSWORD

        - action: "compare_number"
          config:
            value: "{{ fetch.status_code }}"
            threshold: 200
            operator: "=="

    # HTTP check with auth from files
    api_auth_file:
      actions:
        - name: fetch
          action: "http_get"
          config:
            url: "http://localhost:8080/api/protected"
            auth:
              type: "basic"
              username_file: "/secrets/api-username.txt"
              password_file: "/secrets/api-password.txt"

        - action: "compare_number"
          config:
            value: "{{ fetch.status_code }}"
            threshold: 200
            operator: "=="

    # HTTP check with header auth (e.g., API token)
    api_token:
      actions:
        - name: fetch
          action: "http_get"
          config:
            url: "http://localhost:8080/api/data"
            auth:
              type: "header"
              header: "Authorization"
              value_env: "API_TOKEN"  # Reads from $API_TOKEN

        - action: "compare_number"
          config:
            value: "{{ fetch.status_code }}"
            threshold: 200
            operator: "=="

    # File stat check
    log_file:
      actions:
        - action: "file_stat"
          config:
            path: "/var/log/app.log"

    # Regex match example
    config_check:
      actions:
        - name: read_file
          action: "http_get"
          config:
            url: "http://localhost:8080/config"

        - action: "regex_match"
          config:
            input: "{{ read_file.body }}"
            pattern: "enabled.*true"

    # JSON extraction example
    json_check:
      actions:
        - name: fetch
          action: "http_get"
          config:
            url: "http://localhost:8080/api/status"

        - name: parse
          action: "parse_json"
          config:
            input: "{{ fetch.body }}"

        - action: "json_extract"
          config:
            json_ref: "parse.data"
            path: "status"
